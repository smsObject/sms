/** * Created by huangjian on 16/6/6. */function getAttrsHtml(data) {	var temp = $('#goodsAttr-temp-str').html();	var contentHtml = (doT.template(temp))(data);	return contentHtml;}function getPatternListByCat(data) {	var temp = $('#pattern-cat-list-temp').html();	var contentHtml = (doT.template(temp))(data);	return contentHtml;}function getPropertySizeListByCat(data) {	var temp = $('#size-template').html();	var contentHtml = (doT.template(temp))(data);	return contentHtml;}//初始化sku name 以及赌赢的sku idfunction plain2Tree(obj, sku_key_array) {	var len = obj.length;	var result = {};	for (var i = 0; i < len; i++) {		for (var k = 0; k < sku_key_array.length; k++) {			var a = sku_key_array[k].sku_key_id;			if (a === obj[i].sku_key_id) {				var b = obj[i];				result[a] = result[a] || [];				result[a].push(b);				continue;			}			a = null;		}	}	return result;}function getDataHtml(element, data, callback) {	var temp = element.html();	var contentHtml = (doT.template(temp))(data);	callback && callback(contentHtml);}function initStart(seta) {	var result = [];	for (var i = 0; i < seta.length; i++) {		result.push([seta[i]]);	}	return result;}function copy(seta) {	var result = [];	for (var i = 0; i < seta.length; i++) {		result.push(seta[i]);	}	return result;}//mergefunction merge(seta, setb) {	var result = [];	for (var i = 0; i < seta.length; i++) {		for (var j = 0; j < setb.length; j++) {			var a = copy(seta[i]);			var b = setb[j];			a.push(b);			result.push(a);		}	}	return result;}//合并function combination(total) {	//total 必须是数组;	var start = total[0] ? initStart(total[0]) : [[]];	var result = start;	var newResult = [];	for (var i = 1; i < total.length; i++) {		result = merge(result, total[i]);		//newResult = newResult.concat(initStart(total[i])); //将自己也包括进去		newResult = newResult.concat(result);	}	// 为了减少用户的操作复杂度。只需要显示用户显示的那种组合情况	var temp = [];	for (var n = 0; n < newResult.length; n++) {		if (newResult[n].length == total.length) {			temp.push(newResult[n]);		}	}	if (temp.length == 0) {		temp = start;	}	return temp;}//拷贝对象;function deepCopy(source) {	var result = {};	for (var key in source) {		result[key] = typeof source[key] === 'object' ? deepCopy(source[key]) : source[key];	}	return result;}var appGoodsOptions = {	initDataObj: {},	tempData: {},	sizeSkuKeyId: "",	//初始化渲染页面	render: function (orgSourceArray, editSourceArray) {		var data = [];		if (!editSourceArray) {			editSourceArray = [];		}		for (var i = 0; i < orgSourceArray.length; i++) {			var key_list = orgSourceArray[i].sku_key_list;			for (var key in key_list) {				if (key_list.hasOwnProperty(key)) {					var obj = {};					obj["sku_value_id"] = key;					obj["sku_value_name"] = key_list[key]['enName'];					obj["sku_value_name_cn"] = key_list[key]['cnName'] ? key_list[key]['cnName'] : key_list[key]['enName'];					obj["sku_key_id"] = orgSourceArray[i].sku_key_id;					obj["sku_key_name"] = orgSourceArray[i].sku_key_name;					obj["sku_key_name_cn"] = orgSourceArray[i].sku_key_name_cn;					data.push(obj);				}			}		}		for (var n = 0; n < editSourceArray.length; n++) {			for (var m = 0; m < data.length; m++) {				if (data[m].sku_value_id == editSourceArray[n].sku_value_id) {					data[m]['selected'] = true;					data[m]['sort'] = editSourceArray[n].sort;					data[m]['remark'] = editSourceArray[n].remark;					if (editSourceArray[n].is_concat_img) {						data[m]['is_concat_img'] = true;						data[m]['img_name'] = editSourceArray[n].img_name;						data[m]['img_url'] = editSourceArray[n].img_url;					}                    if(editSourceArray[n].is_concat_price){                        data[m]['is_concat_price'] = true;                        data[m]['price'] = editSourceArray[n].price;                    }					continue;				}			}		}		var newData = plain2Tree(data, orgSourceArray);		getDataHtml($('#goodsAttr-temp'), newData, function (content) {			$('.J-goodsAttrWrap-contnet').html(content);			for (var newKey in newData) {				if (newData.hasOwnProperty(newKey)) {					(function (newKey) {						var $easyui_combobox_attr = $('.J-easyui-combobox-attr' + newKey);						var $easyui_combobox_attr_id = $('#easyui-combobox-attr' + newKey);						$easyui_combobox_attr_id.combobox({							valueField: 'sku_value_id',							textField: 'sku_value_name_cn',							multiple: true,							data: newData[newKey],							onLoadSuccess: function (res) {								var len = res.length;								var allHtml = "";								var temp = []; //保存数据								var imgObj = {};                                var priceObj = {};								for (var i = 0; i < len; i++) {									var html = "";									if (!!res[i].selected) {										html = getAttrsHtml(res[i]);										allHtml += html;										temp.push(res[i]);										if(res[i].is_concat_img){											imgObj = res[i];										}                                        if(res[i].is_concat_price){                                            priceObj = res[i];                                        }									}								}								appGoodsOptions.tempData[newKey] = temp;								appGoodsOptions.initData("init");								$easyui_combobox_attr.html(allHtml);								//图片关联处理								if (imgObj.is_concat_img) {									$(".J-checkbox-img-input").prop('disabled', true);									$(".J-checkbox-img-input" + imgObj.sku_key_id).prop('disabled', false);									$(".J-checkbox-img-input" + imgObj.sku_key_id).prop('checked', true);									$(".J-sku-image" + imgObj.sku_key_id).removeClass('fn-hide');								}                                if (priceObj.is_concat_price) {                                    $(".J-checkbox-price-input").prop('disabled', true);                                    $(".J-checkbox-price-input" + priceObj.sku_key_id).prop('disabled', false);                                    $(".J-checkbox-price-input" + priceObj.sku_key_id).prop('checked', true);                                    $(".J-sku-price" + priceObj.sku_key_id).removeClass('fn-hide');                                }							},							onChange: function (newValue, oldValue) {								var data = $easyui_combobox_attr_id.combobox('getData');								var newLen = newValue.length;								var len = data.length;								var allHtml = "";								var arr = [];								var temp = []; //保存数据                                var tempDataHtml;								for (var k = 0; k < newLen; k++) {									var html = "";									for (var i = 0; i < len; i++) {										if (newValue[k] && newValue[k] == data[i].sku_value_id && !arr[i]) {											arr[i] = true;                                            tempDataHtml = data[i];                                            if(!data[i].is_concat_price && $(".J-checkbox-price-input" + newKey).prop("checked")){                                                tempDataHtml["is_concat_price"] = true;                                                tempDataHtml["price"] = $(".J-textbox-value-price").val();                                            }											html = getAttrsHtml(tempDataHtml);											allHtml += html;											temp.push(tempDataHtml);											break;										}									}								}								appGoodsOptions.tempData[newKey] = temp;								appGoodsOptions.initData("create");								$easyui_combobox_attr.html(allHtml);								//图片关联处理								$(".J-checkbox-img-input").each(function(){									var _sku_key_id = $(this).data('sku_key_id');									var checked = $(".J-checkbox-img-input" + _sku_key_id).prop('checked');									if(checked){										$(".J-sku-image" + _sku_key_id).removeClass('fn-hide');									}								});                                $(".J-checkbox-price-input").each(function(){                                    var _sku_key_id = $(this).data('sku_key_id');                                    var checked = $(".J-checkbox-price-input" + _sku_key_id).prop('checked');                                    if(checked){                                        $(".J-sku-price" + _sku_key_id).removeClass('fn-hide');                                    }                                });							}						});					}(newKey));				}			}		});	},	goodsAttr: function (type, catId ,skuData) {		$.ajax({			url: $("#goodsAttrHref").val(),			method: 'get',			data: {				"catId": catId			},			success: function (resObj) {				var orgSourceArray = resObj;				//var orgSourceArray = resObj.orgSource;				appGoodsOptions.initDataObj.orgSource = orgSourceArray;				if (type == 'add') {					appGoodsOptions.render(orgSourceArray);				} else if (type == 'edit') {					//关联图片区域 选择之后的数据					var editSourceArray = skuData;					appGoodsOptions.initDataObj.editSource = editSourceArray;					appGoodsOptions.render(orgSourceArray, editSourceArray);				}			}		});	},	saveDataUsed: [],	orgSaveDataUsed: [],    //关联处理    relatedDataRender: function (sku_key_id,key,type) {        var org = appGoodsOptions.orgSaveDataUsed;        for (var i = 0; i < org.length; i++) {            for (var j = 0; j < org[i].length; j++) {                if (sku_key_id) {                    if (org[i][j][key] && org[i][j]['sku_key_id'] != sku_key_id) {                        //更新原始数据                        delete org[i][j][key];                        delete org[i][j]['is_concat_' + key];                    }                } else {                    if (org[i][j][key]) {                        //更新原始数据                        delete org[i][j][key];                        delete org[i][j]['is_concat_' + key];                    }                }            }        }        if (type == "del") {            //更新编辑需要 保存的单个sku数据            var sk = appGoodsOptions.sendDataSkuSave;            for (var k = 0; k < sk.length; k++) {                if (sk[k][key]) {                    delete sk[k][key];                    delete sk[k]['is_concat_' + key];                }            }        }    },    imgDataCheck :function(sku_key_id){        var org = appGoodsOptions.orgSaveDataUsed;        var result = [];        for (var i = 0; i < org.length; i++) {            result[i] = copy(org[i]);            for (var j = 0; j < org[i].length; j++) {                result[i][j] = deepCopy(org[i][j]);                if (result[i][j]['sku_key_id'] == sku_key_id) {                    result[i][j]['is_concat_img'] = true;                }            }        }        //更新编辑需要 保存的单个sku数据        var sk = appGoodsOptions.sendDataSkuSave;        for(var k = 0; k < sk.length ; k++){            if (sk[k]['sku_key_id'] == sku_key_id) {                sk[k]['is_concat_img'] = true;            }        }        //更新原始数据        appGoodsOptions.orgSaveDataUsed = result;    },	//图片关联处理	imgDataRender: function (sku_key_id,type) {		var org = appGoodsOptions.orgSaveDataUsed;		var saveOrg = appGoodsOptions.saveDataUsed;		for (var i = 0; i < org.length; i++) {			for (var j = 0; j < org[i].length; j++) {				if (sku_key_id) {					if (org[i][j]['sku_key_id'] != sku_key_id) {						//更新原始数据						delete org[i][j]['img_name'];						delete org[i][j]['img_url'];						delete org[i][j]['is_concat_img'];					}				} else {						//更新原始数据						delete org[i][j]['img_name'];						delete org[i][j]['img_url'];						delete org[i][j]['is_concat_img'];				}			}		}		if (type == "del") {			//更新编辑需要 保存的单个sku数据			var sk = appGoodsOptions.sendDataSkuSave;			for (var k = 0; k < sk.length; k++) {					delete sk[k]['img_name'];					delete sk[k]['img_url'];					delete sk[k]['is_concat_img'];			}			//更新编辑需要的应用sku的列表			for (var a = 0; a < saveOrg.length; a++) {				for (var b = 0; b < saveOrg[a].length; b++) {						delete saveOrg[a][b]['img_name'];						delete saveOrg[a][b]['img_url'];						delete saveOrg[a][b]['is_concat_img'];				}			}		}	},	//图片关联处理	imgDataRenderDel: function (img_name) {		var org = appGoodsOptions.orgSaveDataUsed;		var saveOrg = appGoodsOptions.saveDataUsed;		for (var i = 0; i < org.length; i++) {			for (var j = 0; j < org[i].length; j++) {				if (org[i][j]['img_name'] == img_name) {					//更新原始数据					delete org[i][j]['img_name'];					delete org[i][j]['img_url'];					delete org[i][j]['is_concat_img'];				}			}		}		//更新编辑需要 保存的单个sku数据		var sk = appGoodsOptions.sendDataSkuSave;		for (var k = 0; k < sk.length; k++) {			if (sk[k]['img_name'] == img_name) {				delete sk[k]['img_name'];				delete sk[k]['img_url'];				delete sk[k]['is_concat_img'];			}		}		//更新编辑需要的应用sku的列表		for (var a = 0; a < saveOrg.length; a++) {			for (var b = 0; b < saveOrg[a].length; b++) {				if (saveOrg[a][b]['img_name'] == img_name) {					delete saveOrg[a][b]['img_name'];					delete saveOrg[a][b]['img_url'];					delete saveOrg[a][b]['is_concat_img'];				}			}		}		//更新value值		$(".J-button-select-img").each(function(){			var _img_name = $(this).data('img_name');			if(_img_name == img_name){				$(this).data('img_name',"").data('img_url',"");				$(this).siblings('.J-sku-image-value-common').addClass('fn-hide').attr('src', "");			}		});	},    //价格关联处理更新    relatedDataUpdate: function (sku_key_id, key, value) {        var org = appGoodsOptions.orgSaveDataUsed;        var result = [];        for (var i = 0; i < org.length; i++) {            result[i] = copy(org[i]);            for (var j = 0; j < org[i].length; j++) {                result[i][j] = deepCopy(org[i][j]);                if (result[i][j]['sku_key_id'] == sku_key_id) {                    result[i][j][key] = value;                    result[i][j]['is_concat_' + key] = true;                }            }        }        //更新编辑需要 保存的单个sku数据        var sk = appGoodsOptions.sendDataSkuSave;        for(var k = 0; k < sk.length ; k++){            if (sk[k]['sku_key_id'] == sku_key_id) {                sk[k][key] = value;                sk[k]['is_concat_' + key] = true;            }        }        //更新原始数据        appGoodsOptions.orgSaveDataUsed = result;    },	//图片关联处理更新	imgDataUpdate: function (sku_value_id, img_name, img_url) {		var org = appGoodsOptions.orgSaveDataUsed;		var saveOrg = appGoodsOptions.saveDataUsed;		var result = [];		for (var i = 0; i < org.length; i++) {			result[i] = copy(org[i]);			for (var j = 0; j < org[i].length; j++) {				result[i][j] = deepCopy(org[i][j]);				if (result[i][j]['sku_value_id'] == sku_value_id) {					result[i][j]['img_name'] = img_name;					result[i][j]['img_url'] = img_url;					result[i][j]['is_concat_img'] = true;				}			}		}		//更新编辑需要 保存的单个sku数据		var sk = appGoodsOptions.sendDataSkuSave;		for(var k = 0; k < sk.length ; k++){			if (sk[k]['sku_value_id'] == sku_value_id) {				sk[k]['img_name'] = img_name;				sk[k]['img_url'] = img_url;				sk[k]['is_concat_img'] = true;			}		}		//更新编辑需要的应用sku的列表		for (var a = 0; a < saveOrg.length; a++) {			for (var b = 0; b < saveOrg[a].length; b++) {				if (saveOrg[a][b]['sku_value_id'] == sku_value_id) {					saveOrg[a][b]['img_name'] = img_name;					saveOrg[a][b]['img_url'] = img_url;					saveOrg[a][b]['is_concat_img'] = true;				}			}		}		//更新value值		if(img_url) {			$('.J-sku-image-value' + sku_value_id).removeClass('fn-hide').attr('src', img_url).siblings('.J-button-select-img').data('img_name', img_name);		} else {			$('.J-sku-image-value' + sku_value_id).addClass('fn-hide').attr('src', img_url).siblings('.J-button-select-img').data('img_name', img_name);		}		//更新原始数据		appGoodsOptions.orgSaveDataUsed = result;	},	orgSaveDataUsedCopy: function () {		var org = appGoodsOptions.orgSaveDataUsed;		var result = [];		for (var i = 0; i < org.length; i++) {			result[i] = copy(org[i]);			for (var j = 0; j < org[i].length; j++) {				result[i][j] = deepCopy(org[i][j]);			}		}		return result;	},	//更新指定数据的某个key的value值,单个更新	updateDataObj: function (data, old_key, sku_value_id, key, value) {		var org = data;		var result = [];		for (var i = 0; i < org.length; i++) {			result[i] = copy(org[i]);			for (var j = 0; j < org[i].length; j++) {				result[i][j] = deepCopy(org[i][j]);				if (result[i][j][old_key] == sku_value_id) {					result[i][j][key] = value;				}			}		}		return result;	},	//更新初始化的成本价格 全部更新	updateDataObjAllKey: function (data, key, value) {		var org = data;		var result = [];		for (var i = 0; i < org.length; i++) {			result[i] = copy(org[i]);			for (var j = 0; j < org[i].length; j++) {				result[i][j] = deepCopy(org[i][j]);				result[i][j][key] = value;			}		}		return result;	},	//更新sku对象,同时保存修改后的价格	updateDataSkuObj: function (data, index, key, value) {		var org = data;		var sku_value_html = [];		for (var i = 0; i < org.length; i++) {			for (var j = 0; j < org[i].length; j++) {				if (i == index) {					org[i][j][key] = value;					sku_value_html.push(org[i][j]['sku_key_id'] + "-" + org[i][j]['sku_value_id']);				}			}		}		//修改原始价格		var t = sku_value_html.join("-");		var _org = appGoodsOptions.orgSaveDataUsedCopy();		var _index = 0;		for (var l = 0; l < _org.length; l++) {			var _org_len = _org[l].length;			var _sku_value_html = [];			for (var m = 0; m < _org_len; m++) {				_sku_value_html.push(_org[l][m]['sku_key_id'] + "-" + _org[l][m]['sku_value_id']);			}			var _t = _sku_value_html.join('-');			if (t === _t) {				_index = l;			}		}		for (var n = 0; n < _org[_index].length; n++) {			if (key == "price") {				_org[_index][n][key] = Number(value).toFixed(2);			} else {				_org[_index][n][key] = value;			}		}		appGoodsOptions.orgSaveDataUsed = _org;	},	initData: function (type) {		var temp_new = [];		var sd = appGoodsOptions.tempData;		for (var key in sd) {			if (sd.hasOwnProperty(key)) {				var temp = [];				for (var i = 0; i < sd[key].length; i++) {					temp.push(sd[key][i]);				}				if (temp.length > 0) {					temp_new.push(temp);				}			}		}		var result = [];		for (var i = 0; i < temp_new.length; i++) {			for (var j = 0; j < temp_new[i].length; j++) {				result.push(temp_new[i][j]);			}		}		appGoodsOptions.sendDataSkuSave = result; //将选好之前的结果保存		if(type == "create") {//初始化的由初始化好，重新生成的重新获取size			var sizeResult = [];			$.each(result, function (index, obj) {				if (obj.sku_key_id == appGoodsOptions.sizeSkuKeyId) {					sizeResult.push(obj);				}			});			appGoodsOptions.sizeData = sizeResult;		}		appGoodsOptions.orgSaveDataUsed = combination(temp_new); //获取到数据	},	//获取需要的数据	sendDataSkuSave: [],	sendDataSkuSaveUpdate: function (sku_value_id,key,value) {		var sk = appGoodsOptions.sendDataSkuSave;		for (var k = 0; k < sk.length; k++) {			if (sk[k]['sku_value_id'] == sku_value_id) {				sk[k][key] = value;			}		}	},	//尺码转换需要的数据	sizeData:[],	sendDataSaveList: function () {		/*		 "sku_id": "1385137",		 "img_id": "uploads/jollyimg/gallery/201603/02/201603021354qun.jpg",		 "sku_value": "COLOR:Black.SIZE:One Size",		 "COLOR": "Black",		 "SIZE": "One Size",		 "sku_id": "2:1.3:1395"		 */		var org = appGoodsOptions.saveDataUsed;		var returnList = [];		for (var i = 0; i < org.length; i++) {			var obj = {};			var img_name = "";			var img_url = "";			var sku_value = [];			var sku_value_id = [];			var price = "";            var recId = "";			for (var j = 0; j < org[i].length; j++) {				var sku_value_temp = org[i][j]['sku_key_name'] + ":" + org[i][j]['sku_value_name'];				var sku_value_id_temp = org[i][j]['sku_key_id'] + ":" + org[i][j]['sku_value_id'];				if (!img_name) {					img_name = org[i][j]['img_name'];					img_url = org[i][j]['img_url'];				}				if(!price){					price = org[i][j]['price'];				}                recId = org[i][j]['sku_id'];				obj[org[i][j]['sku_key_name']] = org[i][j]['sku_value_name'];                sku_value.push(sku_value_temp.replace(/\./g,"#"));//.需要特殊处理,分隔符				sku_value_id.push(sku_value_id_temp);			}			obj['img_name'] = img_name ? img_name : "";			obj['img_url'] = img_url ? img_url : "";			obj['price'] = price ? price : 0;			obj['sku_value'] = sku_value.join('.');			obj['sku_id'] = sku_value_id.join('.');            obj['recId'] = recId;			returnList.push(obj);		}		return returnList;	},	editDataShow: function (data) {		//这个是sku应用之后,点编辑初始化需要的数据		getDataHtml($('#goodsAttr-temp-sku'), data, function (content) {			$('.J-goodsAttrWrao-sku').html(content);			appGoodsOptions.saveDataUsed = data;			//尺码转换			if ($("#catId").val() != '') {								var catId = $("#catId").val();								var url = $("#sizeConvertHref").val();								$.get(url, {catId: catId}, function (response) {								var data = {									skuSize: appGoodsOptions.sizeData,									countrySize: sizeConfigObj.countrysize,									propertySize: response,									type:"init"								};								var html = getPropertySizeListByCat(data);								$(".J-goods-size").empty().append(html);							}, "json");			}			stringifyAll();		});	},	initImgListData: function (data) {		getDataHtml($('#goodsAttr-temp-str-imgList'), data, function (content) {			$('#dialog-imgList').html(content);		});	},	//让价格同步显示	getPriceShow:function(sku_data,key){		var org = sku_data;		var sku_value_html = [];		var sku_value_html_key_value = []; //保存被修改的值		for (var i = 0; i < org.length; i++) {			var temp = [];			var tempKey = [];			var bool = true;			for (var j = 0; j < org[i].length; j++) {				if (org[i][j][key] && org[i][j][key] > 0) {					temp.push(org[i][j]['sku_key_id'] + "-" + org[i][j]['sku_value_id']);					if (bool) {						tempKey.push(org[i][j][key]);						bool = false;					}				}			}			if (temp.length > 0) {				sku_value_html.push(temp.join("-"));				sku_value_html_key_value.push(tempKey.join(""));			}		}		for (var k = 0; k < sku_value_html.length; k++) {			//修改原始价格			var t = sku_value_html[k];			var t_value = sku_value_html_key_value[k];			var _org = appGoodsOptions.orgSaveDataUsedCopy();			var _index = -1;			for (var l = 0; l < _org.length; l++) {				var _org_len = _org[l].length;				var _sku_value_html = [];				for (var m = 0; m < _org_len; m++) {					_sku_value_html.push(_org[l][m]['sku_key_id'] + "-" + _org[l][m]['sku_value_id']);				}				var _t = _sku_value_html.join('-');				if (t === _t) {					_index = l;				}			}			if(_index > -1){				for (var n = 0; n < _org[_index].length; n++) {					if (key == "price") {						_org[_index][n][key] = Number(t_value).toFixed(2);					} else {						_org[_index][n][key] = t_value;					}				}				appGoodsOptions.orgSaveDataUsed = _org;			}		}	},	getSkuDataList: function () {	//	var value = $('.J-textbox-value-price').val();	//	appGoodsOptions.orgSaveDataUsed = appGoodsOptions.updateDataObjAllKey(appGoodsOptions.orgSaveDataUsed,"price",value);	//	appGoodsOptions.getPriceShow(appGoodsOptions.saveDataUsed,'price');		getDataHtml($('#goodsAttr-temp-sku'), appGoodsOptions.orgSaveDataUsed, function (content) {			$('.J-goodsAttrWrao-sku').html(content);			appGoodsOptions.saveDataUsed = appGoodsOptions.orgSaveDataUsedCopy();			//点击应用更新隐藏域的值			var skuProductRelation = JSON.stringify(appGoodsOptions.sendDataSkuSave);			var skuRelation = JSON.stringify(appGoodsOptions.sendDataSaveList());			$("#J_sku_relation").val(skuRelation);			$("#J_sku_product_relation").val(skuProductRelation);			//尺码转换			if ($("#catId").val() != '') {				var catId = $("#catId").val();				$.get($('#sizeConvertHref').val(), {catId: catId}, function (response) {					var data = {						skuSize: appGoodsOptions.sizeData,						countrySize: sizeConfigObj.countrysize,						propertySize: response					};					var html = getPropertySizeListByCat(data);					$(".J-goods-size").empty().append(html);				}, "json");			}		});	},	/**	 * @param type	 * @param catId	 * @param skuListData sku列表编辑数据	 * @param skuData sku选择数据	 */	init: function (type, catId, skuListData, skuData) {		//可以通过点击某个按钮触发数据		if (type == "edit") {			appGoodsOptions.goodsAttr(type, catId, skuData);			appGoodsOptions.editDataShow(skuListData);		} else if (type == "add") {			appGoodsOptions.goodsAttr(type, catId);			appGoodsOptions.saveDataUsed = appGoodsOptions.orgSaveDataUsedCopy();		}		//$('#upload-pic1').filebox({		//	buttonText: '选择文件',		//	buttonAlign: 'left'		//});		//删除用的临时数据		var boolArray = [];		$(document).on('click', '.J-easyui-linkbutton-del', function () {            if(isEditSku){                var $that = $(this);                $.messager.confirm('操作提示', '你确定要删除这条sku记录吗?', function (r) {                    if (r) {                        var index = Number($that.data('index'));                        if (!boolArray[index]) {                            boolArray[index] = true;                            appGoodsOptions.saveDataUsed.splice(index, 1);                            getDataHtml($('#goodsAttr-temp-sku'), appGoodsOptions.saveDataUsed, function (content) {                                $('.J-goodsAttrWrao-sku').html(content);                                boolArray[index] = false;                                //删除用的临时数据更新隐藏域的值                                var skuRelation =  JSON.stringify(appGoodsOptions.sendDataSaveList());                                $("#J_sku_relation").val(skuRelation);                            });                        }                        $that = null;                    }                });            }else{                $.messager.alert("提示","第三方系统接入，SKU不允许重新生成",'info');            }		});        //关联价格        $(document).on('change', '.J-checkbox-price-input', function () {            var checked = $(this).prop('checked');            var sku_key_id = $(this).data('sku_key_id');            var $sku_price = $(".J-sku-price" + sku_key_id);            var value = $(".J-textbox-value-price").val();            if (checked) {                $sku_price.removeClass('fn-hide');                $(".J-easyui-textbox-price" + sku_key_id).val(value);                appGoodsOptions.relatedDataUpdate(sku_key_id, "price", value);            } else {                $sku_price.addClass('fn-hide');                appGoodsOptions.relatedDataRender(null,'price','del');            }            $('.J-checkbox-price-input').each(function () {                var _checked = $(this).prop('checked');                if (!_checked && checked) {                    $(this).prop("disabled", true);                }                if (!_checked && !checked) {                    $(this).prop("disabled", false);                }            });        });		//关联图片		$(document).on('change', '.J-checkbox-img-input', function () {			var checked = $(this).prop('checked');			var sku_key_id = $(this).data('sku_key_id');			var $sku_img = $(".J-sku-image" + sku_key_id);			if (checked) {				$sku_img.removeClass('fn-hide');                appGoodsOptions.imgDataCheck(sku_key_id);			} else {				$sku_img.addClass('fn-hide');				$sku_img.find('img').addClass('fn-hide').attr('src',"");				$sku_img.find('.J-button-select-img').data('img_name',"");				appGoodsOptions.imgDataRender(null,'del');			}			$('.J-checkbox-img-input').each(function () {				var _checked = $(this).prop('checked');				if (!_checked && checked) {					$(this).prop("disabled", true);				}				if (!_checked && !checked) {					$(this).prop("disabled", false);				}			});		});		//图片选择		$(document).on('click', '.J-button-select-img', function () {			var sku_value_id = $(this).data('sku_value_id');			var img_name = $(this).data('img_name');			$('#dialog-imgList').show();			$('.J-imgList').find('li').each(function () {				var _img_name = $(this).data('img_name');				if (_img_name == img_name && img_name) {					$(this).addClass('active');				} else {					$(this).removeClass('active');				}			});			$('#dialog-imgList').dialog({				title: '图片选择',				width: 600,				height: 400,				closed: false,				cache: false,				modal: true,				resizable:true,				buttons: [{					text: '确定',					iconCls: 'icon-ok',					handler: function () {						var temp_img_name = "";						var temp_img_url = "";						var temp = true;						$('.J-imgList').find('li').each(function () {							var _img_name = $(this).data('img_name');							var _img_url = $(this).find('img').attr('src');							if ($(this).hasClass('active') && temp) {								temp_img_name = _img_name;								temp_img_url = _img_url;								temp = false;							}						});						if (img_name != temp_img_name) {							appGoodsOptions.imgDataUpdate(sku_value_id, temp_img_name, temp_img_url);						}						var skuRelation =  JSON.stringify(appGoodsOptions.sendDataSaveList());						$("#J_sku_relation").val(skuRelation);						img_name = null;						sku_value_id = null;						$('#dialog-imgList').dialog('close');					}				}]			});		});		//选择图片之后的操作		$(document).on('click', '.J-imgList li', function () {			if (!$(this).hasClass('active')) {				$(this).addClass('active').siblings('li').removeClass('active');				$('#dialog-imgList').find('.icon-ok').trigger('click');			} else {				$(this).removeClass('active');			}		});        //price        $(document).on('change', '.J-easyui-textbox-price', function () {            var sku_value_id = $(this).data('sku_value_id');            var value = Number($(this).val());            if (isNaN(value)) {                value = 0;                $(this).val(value);                return false;            }            appGoodsOptions.sendDataSkuSaveUpdate(sku_value_id, 'price', value); //更新需要保存的数据            appGoodsOptions.orgSaveDataUsed = appGoodsOptions.updateDataObj(appGoodsOptions.orgSaveDataUsed,'sku_value_id', sku_value_id, 'price', value);        });		//排序		$(document).on('change', '.J-easyui-textbox-sort', function () {			var sku_value_id = $(this).data('sku_value_id');			var value = Number($(this).val());			if (isNaN(value)) {				value = 0;				$(this).val(value);				return false;			}			appGoodsOptions.sendDataSkuSaveUpdate(sku_value_id, 'sort', value); //更新需要保存的数据			appGoodsOptions.orgSaveDataUsed = appGoodsOptions.updateDataObj(appGoodsOptions.orgSaveDataUsed,'sku_value_id', sku_value_id, 'sort', value);			appGoodsOptions.saveDataUsed = appGoodsOptions.updateDataObj(appGoodsOptions.saveDataUsed,'sku_value_id', sku_value_id, 'sort', value);		});		//备注		$(document).on('change', '.J-easyui-textbox-remark', function () {			var sku_value_id = $(this).data('sku_value_id');			var value = $(this).val();			appGoodsOptions.sendDataSkuSaveUpdate(sku_value_id, 'remark', value); //更新需要保存的数据			appGoodsOptions.orgSaveDataUsed = appGoodsOptions.updateDataObj(appGoodsOptions.orgSaveDataUsed,'sku_value_id', sku_value_id, 'remark', value);			appGoodsOptions.saveDataUsed = appGoodsOptions.updateDataObj(appGoodsOptions.saveDataUsed,'sku_value_id', sku_value_id, 'remark', value);		});		//修改价格		$(document).on('change', '.J-easyui-textbox-orgPrice', function () {			var index = $(this).data('index');			var price = $(this).data('price');			var value = Number($(this).val());			if (isNaN(value)) {				value = price;				$(this).val(value);				return false;			}			appGoodsOptions.updateDataSkuObj(appGoodsOptions.saveDataUsed, index, 'price', value);			//点击修改价格更新隐藏域的值			var skuRelation = JSON.stringify(appGoodsOptions.sendDataSaveList());			$("#J_sku_relation").val(skuRelation);		});		//save 按钮设置		//这里是提交的按钮 自己写	}};function plusSizeFix(){	$(".countrySizeInput").each(function(index){		var sizeName = $(this).attr("data-name");		var countryId = $(this).attr("data-cid");		if ($("input[name='patternKey[315][]']").is("checked")){			if (typeof  sizeConfigObj.plusSizeParam[sizeName] != 'undefined' &&				typeof sizeConfigObj.plusSizeParam[sizeName][countryId] != "undefined"){				$(this).val(sizeConfigObj.plusSizeParam[sizeName][countryId]);			}		}else{			$(this).val("");		}	})}function seriableSize(){	var propertySizeList = [];	$(".J_property_sizes").each(function(index){		var recId = $(this).attr("data-id");		var sizeName = $(this).attr("data-size");		var sizeId = $(this).attr("data-size-id");		var propertyName = $(this).attr("data-property");		var propertyId = $(this).attr("data");		if($(this).val() != ''){			var obj = {size:sizeName,propertyName:propertyName,cm:$.trim($(this).val()),				propertyKeyRecId:propertyId,sizeKeyRecId:sizeId};			if (recId != ""){				obj.recId = recId;			}			propertySizeList.push(obj);		}	});	$("#J_propertySize").val(JSON.stringify(propertySizeList));    var countrySizeList = [];    $(".countrySizeInput").each(function(index){        var id = $(this).attr("data-id");        var countryId = $(this).attr("data-cid");        var countryValue = $(this).val();        var sizeId = $(this).attr("data-size");        if (countryValue != "") {            if (countryValue.indexOf("/") > 0) {                var countryValues = countryValue.split("/");                for (var value in countryValues) {                    if($.trim(countryValues[value]) == ""){                        continue;                    }                    //均码的保存                    var countryObj = {countryId: countryId, countryValue: countryValues[value],                        sizeId: sizeId};                    if (id != "") {                        countryObj.id = id;                    }                    countrySizeList.push(countryObj);                }            } else {                var countryObj = {countryId: countryId, countryValue: countryValue,                    sizeId: sizeId};                if (id != "") {                    countryObj.id = id;                }                countrySizeList.push(countryObj);            }        }    });    $("#J_countrySize").val(JSON.stringify(countrySizeList));}$(document).on("change",".J_country_size_22",function(){    var cid = $(this).attr("data-cid");    var sizeId = $(this).attr("data-size");    var  val = $(this).val();    if(val == ""){        $(".J_size_22_" + sizeId).val("");    }else{        $.ajax({            type: "POST",            async: false,            url: $("#querySizeByUkSize").val(),            data: {                ukSizeValues: val,                catId: $('#catId').val()            },			success: function (data) {				var result = data;				if (result.errorMsg) {				} else {					var resultName = result.result;					if (resultName.ukName) {						$(".J_size_21_" + sizeId).val(resultName.uscaName);						$(".J_size_22_" + sizeId).val(resultName.ukName);						$(".J_size_23_" + sizeId).val(resultName.euName);						$(".J_size_24_" + sizeId).val(resultName.intName);					}				}            }        });    }});$(document).on("change",".J_size_entity",function(){	var value = $.trim($(this).val());	var cid = $(this).attr("data-cid");	var $this = $(this);	if(cid==21||cid==22||cid==23||cid==24){		return;	}	if(isNaN(value)){		$.messager.alert('提示','格式错误,请输入数字','info',function (){			$this.val('').focus();		});		return false;	}	seriableSize();});function stringifyAll(){	//尺码	seriableSize();	//sku	var skuProductRelation =  JSON.stringify(appGoodsOptions.sendDataSkuSave);	var skuRelation =  JSON.stringify(appGoodsOptions.sendDataSaveList());	$("#J_sku_relation").val(skuRelation);	$("#J_sku_product_relation").val(skuProductRelation);	//图片	saveImageListToText();}var sizeConfigObj = {"countrysize":{"21":"US\/CA","22":"UK\/AU","23":"EU","24":"INT"},	"euToIntIize":{"28":"XXXXS","30":"XXXS","32":"XXS","34":"XS","36":"S","38":"M","40":"L","42":"XL","44":"XXL","46":"XXXL","48":"XXXXL","50":"XXXXXL","52":"XXXXXXL"},	"topSizeParam":{"XXS":{"21":"00","22":2,"23":30,"24":"XXXS"},"XS":{"21":0,"22":4,"23":32,"24":"XXS"},"S":{"21":2,"22":6,"23":34,"24":"XS"},"M":{"21":4,"22":8,"23":36,"24":"S"},"L":{"21":6,"22":10,"23":38,"24":"M"},"XL":{"21":8,"22":12,"23":40,"24":"L"},"XXL":{"21":10,"22":14,"23":42,"24":"XL"},"XXXL":{"21":12,"22":16,"23":44,"24":"XXL"},"XXXXL":{"21":14,"22":18,"23":46,"24":"XXXL"},"XXXXXL":{"21":16,"22":20,"23":48,"24":"XXXXL"},"XXXXXXL":{"21":18,"22":22,"23":50,"24":"XXXXXL"}},	"bottomSizeParam":{"XS":{"21":"00","22":2,"23":30,"24":"XXXS"},"S":{"21":0,"22":4,"23":32,"24":"XXS"},"M":{"21":2,"22":6,"23":34,"24":"XS"},"L":{"21":4,"22":8,"23":36,"24":"S"},"XL":{"21":6,"22":10,"23":38,"24":"M"},"XXL":{"21":8,"22":12,"23":40,"24":"L"},"XXXL":{"21":10,"22":14,"23":42,"24":"XL"},"XXXXL":{"21":12,"22":16,"23":44,"24":"XXXL"},"XXXXXL":{"21":14,"22":18,"23":46,"24":"XXXXL"},"XXXXXXL":{"21":16,"22":20,"23":48,"24":"XXXXXL"}},	"plusSizeParam":{"L":{"21":4,"22":8,"23":36,"24":"S"},"XL":{"21":6,"22":10,"23":38,"24":"M"},"XXL":{"21":8,"22":12,"23":40,"24":"L"},"XXXL":{"21":10,"22":14,"23":42,"24":"XL"},"XXXXL":{"21":12,"22":16,"23":44,"24":"XXL"},"XXXXXL":{"21":14,"22":18,"23":46,"24":"XXXL"},"XXXXXXL":{"21":16,"22":20,"23":48,"24":"XXXXL"}},	"topAndBottomCatId":{"top":[6,93,8,14,106,116,73],"bottom":[43,16,91,92,34]}}